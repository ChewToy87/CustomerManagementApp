@page
@model CustomerManagementClient.Pages.IndexModel
@addTagHelper *, Microsoft.AspNetCore.Mvc.TagHelpers

@Html.AntiForgeryToken()

<div class="container">
    <h1 class="my-4">@Model.PageTitle</h1>

    <div class="mb-3 d-flex justify-content-end">
        <button id="saveChangesButton" class="btn btn-success"
                hx-post="@Url.Page("/Index", pageHandler: "SaveChanges")"
                hx-trigger="click"
                hx-target="#modalContainer"
                hx-swap="innerHTML">
            <i class="fa fa-save"></i> Save Changes
        </button>
    </div>

    <div class="table-responsive position-relative">
        <!-- Spinner Overlay -->
        <div id="spinnerOverlay" class="spinner-overlay d-none">
            <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">Loading...</span>
            </div>
        </div>

        <table class="table table-striped table-bordered table-hover" id="customerTable">
            <thead class="table-light">
                <tr>
                    <th style="width: 20%;">First Name</th>
                    <th style="width: 20%;">Surname</th>
                    <th style="width: 25%;">Email</th>
                    <th style="width: 25%;">Phone Number</th>
                    <th style="width: 10%;">Actions</th>
                </tr>
            </thead>
            <tbody id="customerTableBody">
                @foreach (var customer in Model.Customers)
                {
                    if (customer.IsDeleted)
                    {
                        <partial name="Partials/_CustomerDeletedRowPartial" model="customer" />
                    }
                    else if (customer.IsEditing)
                    {
                        <partial name="Partials/_CustomerEditRowPartial" model="customer" />
                    }
                    else
                    {
                        <partial name="Partials/_CustomerRowPartial" model="customer" />
                    }
                }
            </tbody>

            <!-- Add Button Row -->
            <tfoot>
                <tr>
                    <td colspan="5" class="p-0">
                        <button class="btn btn-primary w-100 rounded-0"
                                style="border-top-left-radius: 0; border-top-right-radius: 0;"
                                hx-post="@Url.Page("/Index", pageHandler: "AddCustomer")"
                                hx-target="#customerTableBody"
                                hx-swap="beforeend"
                                onclick="checkForUnsavedChanges()">
                            <i class="fa fa-plus"></i> Add Customer
                        </button>
                    </td>
                </tr>
            </tfoot>
        </table>
    </div>

    <!-- Confirmation Modal Container -->
    <div id="modalContainer"></div>
</div>
